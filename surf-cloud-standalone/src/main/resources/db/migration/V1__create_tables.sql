CREATE TABLE IF NOT EXISTS cloud_players (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, uuid UUID NOT NULL, last_server CHAR(255) NULL, last_seen TIMESTAMP(6) NULL, last_ip_address VARCHAR(45) NULL);
ALTER TABLE cloud_players ADD CONSTRAINT cloud_players_uuid_unique UNIQUE (uuid);
CREATE TABLE IF NOT EXISTS punish_bans (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, punishment_id CHAR(8) NOT NULL, parent_punishment_id BIGINT DEFAULT NULL NULL, punished_player_id BIGINT NOT NULL, issuer_player_id BIGINT DEFAULT NULL NULL, reason LONGTEXT NULL, unpunished BOOLEAN DEFAULT FALSE NOT NULL, unpunished_date TIMESTAMP(6) DEFAULT NULL NULL, unpunisher_player_id BIGINT DEFAULT NULL NULL, expiration_date TIMESTAMP(6) DEFAULT NULL NULL, permanent BOOLEAN DEFAULT FALSE NOT NULL, security_ban BOOLEAN DEFAULT FALSE NOT NULL, raw BOOLEAN DEFAULT FALSE NOT NULL);
ALTER TABLE punish_bans ADD CONSTRAINT punish_bans_punishment_id_unique UNIQUE (punishment_id);
CREATE INDEX punish_bans_punished_player_id ON punish_bans (punished_player_id);
CREATE INDEX idx_permanent_exp ON punish_bans (permanent, expiration_date);
CREATE TABLE IF NOT EXISTS punish_kicks (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, punishment_id CHAR(8) NOT NULL, parent_punishment_id BIGINT DEFAULT NULL NULL, punished_player_id BIGINT NOT NULL, issuer_player_id BIGINT DEFAULT NULL NULL, reason LONGTEXT NULL);
ALTER TABLE punish_kicks ADD CONSTRAINT punish_kicks_punishment_id_unique UNIQUE (punishment_id);
CREATE INDEX punish_kicks_punished_player_id ON punish_kicks (punished_player_id);
CREATE TABLE IF NOT EXISTS punish_mutes (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, punishment_id CHAR(8) NOT NULL, parent_punishment_id BIGINT DEFAULT NULL NULL, punished_player_id BIGINT NOT NULL, issuer_player_id BIGINT DEFAULT NULL NULL, reason LONGTEXT NULL, unpunished BOOLEAN DEFAULT FALSE NOT NULL, unpunished_date TIMESTAMP(6) DEFAULT NULL NULL, unpunisher_player_id BIGINT DEFAULT NULL NULL, expiration_date TIMESTAMP(6) DEFAULT NULL NULL, permanent BOOLEAN DEFAULT FALSE NOT NULL);
ALTER TABLE punish_mutes ADD CONSTRAINT punish_mutes_punishment_id_unique UNIQUE (punishment_id);
CREATE INDEX punish_mutes_punished_player_id ON punish_mutes (punished_player_id);
CREATE INDEX idx_permanent_exp ON punish_mutes (permanent, expiration_date);
CREATE TABLE IF NOT EXISTS punish_warnings (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, punishment_id CHAR(8) NOT NULL, parent_punishment_id BIGINT DEFAULT NULL NULL, punished_player_id BIGINT NOT NULL, issuer_player_id BIGINT DEFAULT NULL NULL, reason LONGTEXT NULL);
ALTER TABLE punish_warnings ADD CONSTRAINT punish_warnings_punishment_id_unique UNIQUE (punishment_id);
CREATE INDEX punish_warnings_punished_player_id ON punish_warnings (punished_player_id);
CREATE TABLE IF NOT EXISTS punish_ban_ip_addresses (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, ip_address CHAR(45) NOT NULL, punishment BIGINT NOT NULL);
CREATE INDEX idx_ip_address ON punish_ban_ip_addresses (ip_address);
CREATE TABLE IF NOT EXISTS punish_notes_ban (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, note_id UUID NOT NULL, punishment_id BIGINT NOT NULL, note LONGTEXT NOT NULL, creator_id BIGINT DEFAULT NULL NULL, generated BOOLEAN DEFAULT FALSE NOT NULL);
ALTER TABLE punish_notes_ban ADD CONSTRAINT punish_notes_ban_note_id_unique UNIQUE (note_id);
CREATE TABLE IF NOT EXISTS punish_notes_kick (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, note_id UUID NOT NULL, punishment_id BIGINT NOT NULL, note LONGTEXT NOT NULL, creator_id BIGINT DEFAULT NULL NULL, generated BOOLEAN DEFAULT FALSE NOT NULL);
ALTER TABLE punish_notes_kick ADD CONSTRAINT punish_notes_kick_note_id_unique UNIQUE (note_id);
CREATE TABLE IF NOT EXISTS punish_notes_mute (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, note_id UUID NOT NULL, punishment_id BIGINT NOT NULL, note LONGTEXT NOT NULL, creator_id BIGINT DEFAULT NULL NULL, generated BOOLEAN DEFAULT FALSE NOT NULL);
ALTER TABLE punish_notes_mute ADD CONSTRAINT punish_notes_mute_note_id_unique UNIQUE (note_id);
CREATE TABLE IF NOT EXISTS punish_notes_warn (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, note_id UUID NOT NULL, punishment_id BIGINT NOT NULL, note LONGTEXT NOT NULL, creator_id BIGINT DEFAULT NULL NULL, generated BOOLEAN DEFAULT FALSE NOT NULL);
ALTER TABLE punish_notes_warn ADD CONSTRAINT punish_notes_warn_note_id_unique UNIQUE (note_id);
CREATE TABLE IF NOT EXISTS whitelists (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, blocked BOOLEAN DEFAULT FALSE NOT NULL, `group` VARCHAR(255) NULL, `server_name` VARCHAR(255) NULL, cloud_player_id BIGINT NOT NULL, CONSTRAINT fk_whitelists_cloud_player_id__id FOREIGN KEY (cloud_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT ck_group_xor_server CHECK (((`group` IS NOT NULL) AND (`server_name` IS NULL)) OR ((`group` IS NULL) AND (`server_name` IS NOT NULL))));
ALTER TABLE whitelists ADD CONSTRAINT whitelists_cloud_player_id_group_unique UNIQUE (cloud_player_id, `group`);
ALTER TABLE whitelists ADD CONSTRAINT whitelists_cloud_player_id_server_name_unique UNIQUE (cloud_player_id, `server_name`);
CREATE TABLE IF NOT EXISTS cloud_player_name_histories (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, `name` CHAR(16) NOT NULL, cloud_player_id BIGINT NOT NULL, CONSTRAINT fk_cloud_player_name_histories_cloud_player_id__id FOREIGN KEY (cloud_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE);
CREATE TABLE IF NOT EXISTS cloud_player_playtimes (id BIGINT AUTO_INCREMENT PRIMARY KEY, created_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6) NOT NULL, `server_name` CHAR(255) NOT NULL, category VARCHAR(255) NOT NULL, duration_seconds BIGINT DEFAULT 0 NOT NULL, cloud_player_id BIGINT NOT NULL, CONSTRAINT fk_cloud_player_playtimes_cloud_player_id__id FOREIGN KEY (cloud_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE);
ALTER TABLE punish_bans ADD CONSTRAINT fk_punish_bans_parent_punishment_id__id FOREIGN KEY (parent_punishment_id) REFERENCES punish_bans(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_bans ADD CONSTRAINT fk_punish_bans_punished_player_id__id FOREIGN KEY (punished_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_bans ADD CONSTRAINT fk_punish_bans_issuer_player_id__id FOREIGN KEY (issuer_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_bans ADD CONSTRAINT fk_punish_bans_unpunisher_player_id__id FOREIGN KEY (unpunisher_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_kicks ADD CONSTRAINT fk_punish_kicks_parent_punishment_id__id FOREIGN KEY (parent_punishment_id) REFERENCES punish_kicks(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_kicks ADD CONSTRAINT fk_punish_kicks_punished_player_id__id FOREIGN KEY (punished_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_kicks ADD CONSTRAINT fk_punish_kicks_issuer_player_id__id FOREIGN KEY (issuer_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_mutes ADD CONSTRAINT fk_punish_mutes_parent_punishment_id__id FOREIGN KEY (parent_punishment_id) REFERENCES punish_mutes(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_mutes ADD CONSTRAINT fk_punish_mutes_punished_player_id__id FOREIGN KEY (punished_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_mutes ADD CONSTRAINT fk_punish_mutes_issuer_player_id__id FOREIGN KEY (issuer_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_mutes ADD CONSTRAINT fk_punish_mutes_unpunisher_player_id__id FOREIGN KEY (unpunisher_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_warnings ADD CONSTRAINT fk_punish_warnings_parent_punishment_id__id FOREIGN KEY (parent_punishment_id) REFERENCES punish_warnings(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_warnings ADD CONSTRAINT fk_punish_warnings_punished_player_id__id FOREIGN KEY (punished_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_warnings ADD CONSTRAINT fk_punish_warnings_issuer_player_id__id FOREIGN KEY (issuer_player_id) REFERENCES cloud_players(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_ban_ip_addresses ADD CONSTRAINT fk_punish_ban_ip_addresses_punishment__id FOREIGN KEY (punishment) REFERENCES punish_bans(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_notes_ban ADD CONSTRAINT fk_punish_notes_ban_punishment_id__id FOREIGN KEY (punishment_id) REFERENCES punish_bans(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_notes_kick ADD CONSTRAINT fk_punish_notes_kick_punishment_id__id FOREIGN KEY (punishment_id) REFERENCES punish_kicks(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_notes_mute ADD CONSTRAINT fk_punish_notes_mute_punishment_id__id FOREIGN KEY (punishment_id) REFERENCES punish_mutes(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE punish_notes_warn ADD CONSTRAINT fk_punish_notes_warn_punishment_id__id FOREIGN KEY (punishment_id) REFERENCES punish_warnings(id) ON DELETE CASCADE ON UPDATE CASCADE;
